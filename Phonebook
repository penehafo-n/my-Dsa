import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.util.LinkedList;
import java.util.Comparator;

public class ModernPhonebookApp extends JFrame {
    private DefaultListModel<Contact> contactListModel;
    private JList<Contact> contactJList;
    private JTextField searchField;
    private JButton deleteButton, insertButton, updateButton, textButton, callButton, videoCallButton;
    private LinkedList<Contact> contactList;
    private JPanel actionButtonPanel;

    public ModernPhonebookApp() {
        // Initialize the contact list
        contactList = new LinkedList<>();

        // Frame setup
        setTitle("Modern Phonebook");
        setSize(600, 500);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(new BorderLayout());
        getContentPane().setBackground(new Color(240, 240, 240)); // Light Gray

        // Search panel
        JPanel searchPanel = new JPanel(new BorderLayout());
        searchPanel.setBackground(new Color(240, 240, 240)); // Light Gray
        searchPanel.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));
        searchPanel.add(new JLabel("Search:"), BorderLayout.WEST);
        searchField = new JTextField();
        searchPanel.add(searchField, BorderLayout.CENTER);
        add(searchPanel, BorderLayout.NORTH);

        // Contact list model and list component
        contactListModel = new DefaultListModel<>();
        contactJList = new JList<>(contactListModel);
        contactJList.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);
        contactJList.setBackground(Color.WHITE); // Soft White
        contactJList.setForeground(new Color(51, 51, 51)); // Dark Gray
        JScrollPane listScrollPane = new JScrollPane(contactJList);
        add(listScrollPane, BorderLayout.CENTER);

        // Action buttons panel
        actionButtonPanel = new JPanel(new FlowLayout(FlowLayout.RIGHT));
        deleteButton = new JButton("Delete");
        deleteButton.setEnabled(false);
        deleteButton.setBackground(new Color(244, 67, 54)); // Bright Red
        deleteButton.setForeground(Color.WHITE);
        actionButtonPanel.add(deleteButton);

        insertButton = new JButton("Insert");
        insertButton.setBackground(new Color(0, 86, 179)); // Deep Blue
        insertButton.setForeground(Color.WHITE);
        actionButtonPanel.add(insertButton);

        updateButton = new JButton("Update");
        updateButton.setEnabled(false); // Disable update button when no contact is selected
        updateButton.setBackground(new Color(0, 86, 179)); // Deep Blue
        updateButton.setForeground(Color.WHITE);
        actionButtonPanel.add(updateButton);

        // Initialize action buttons but don't add them to the panel yet
        textButton = new JButton("Text");
        textButton.setEnabled(false);
        textButton.setBackground(new Color(0, 128, 0)); // Green
        textButton.setForeground(Color.WHITE);
        actionButtonPanel.add(textButton);

        callButton = new JButton("Call");
        callButton.setEnabled(false);
        callButton.setBackground(new Color(0, 128, 255)); // Light Blue
        callButton.setForeground(Color.WHITE);
        actionButtonPanel.add(callButton);

        videoCallButton = new JButton("Video Call");
        videoCallButton.setEnabled(false);
        videoCallButton.setBackground(new Color(255, 165, 0)); // Orange
        videoCallButton.setForeground(Color.WHITE);
        actionButtonPanel.add(videoCallButton);

        // Add actionButtonPanel to the bottom of the frame
        add(actionButtonPanel, BorderLayout.SOUTH);

        // Event listeners
        contactJList.addListSelectionListener(e -> {
            if (!e.getValueIsAdjusting()) {
                Contact selectedContact = contactJList.getSelectedValue();
                boolean isSelected = selectedContact != null;
                deleteButton.setEnabled(isSelected);
                updateButton.setEnabled(isSelected);
                textButton.setEnabled(isSelected);
                callButton.setEnabled(isSelected);
                videoCallButton.setEnabled(isSelected);
            }
        });

        contactJList.addMouseListener(new MouseAdapter() {
            public void mouseClicked(MouseEvent e) {
                if (e.getClickCount() == 2) {
                    Contact selectedContact = contactJList.getSelectedValue();
                    if (selectedContact != null) {
                        showContactDetails(selectedContact);
                    }
                }
            }
        });

        searchField.addKeyListener(new KeyAdapter() {
            public void keyReleased(KeyEvent e) {
                searchContacts(searchField.getText());
            }
        });

        deleteButton.addActionListener(e -> deleteContacts());
        insertButton.addActionListener(e -> insertNewContact());
        updateButton.addActionListener(e -> updateSelectedContacts());
        textButton.addActionListener(e -> performText());
        callButton.addActionListener(e -> performCall());
        videoCallButton.addActionListener(e -> performVideoCall());

        // Load contacts from a data source to avoid duplicates on each run
        loadContacts();
    }

    // Load contacts to avoid duplication
    private void loadContacts() {
        // You can implement loading logic from a file or database here.
        // For now, it will remain empty to avoid duplication.
    }

    // Method to insert a new contact
    private void insertContact(String name, String surname, String phone, String email, String address) {
        // Remove spaces from phone number
        phone = phone.replaceAll("\\s+", "");

        if (!phoneExists(phone)) {
            Contact newContact = new Contact(name, surname, phone, email, address);
            contactList.add(newContact);
            sortContacts();
            updateContactListModel();
        } else {
            showError("This phone number already exists.");
        }
    }

    // Check if the phone number already exists
    private boolean phoneExists(String phone) {
        return contactList.stream().anyMatch(contact -> contact.getPhone().equals(phone));
    }

    // Insert a new contact via dialog
    private void insertNewContact() {
        while (true) { // Loop to allow multiple entries
            JTextField nameField = new JTextField();
            JTextField surnameField = new JTextField();
            JTextField phoneField = new JTextField();
            JTextField emailField = new JTextField();
            JTextField addressField = new JTextField();

            Object[] message = {
                    "First Name:", nameField,
                    "Surname:", surnameField,
                    "Phone Number:", phoneField,
                    "Email:", emailField,
                    "Address:", addressField
            };

            int option = JOptionPane.showConfirmDialog(this, message, "Insert New Contact", JOptionPane.OK_CANCEL_OPTION);
            if (option == JOptionPane.OK_OPTION) {
                insertContact(nameField.getText(), surnameField.getText(), phoneField.getText(), emailField.getText(), addressField.getText());
            } else {
                break; // Exit loop if user cancels
            }
        }
    }

    // Update the selected contacts via dialog
    private void updateSelectedContacts() {
        Contact[] selectedContacts = contactJList.getSelectedValuesList().toArray(new Contact[0]);
        for (Contact selectedContact : selectedContacts) {
            JTextField nameField = new JTextField(selectedContact.getFirstName());
            JTextField surnameField = new JTextField(selectedContact.getSurname());
            JTextField phoneField = new JTextField(selectedContact.getPhone());
            JTextField emailField = new JTextField(selectedContact.getEmail());
            JTextField addressField = new JTextField(selectedContact.getAddress());

            Object[] message = {
                    "First Name:", nameField,
                    "Surname:", surnameField,
                    "Phone Number:", phoneField,
                    "Email:", emailField,
                    "Address:", addressField
            };

            int option = JOptionPane.showConfirmDialog(this, message, "Update Contact", JOptionPane.OK_CANCEL_OPTION);
            if (option == JOptionPane.OK_OPTION) {
                String newPhone = phoneField.getText().replaceAll("\\s+", ""); // Remove spaces
                if (!phoneExists(newPhone) || newPhone.equals(selectedContact.getPhone())) {
                    selectedContact.setFirstName(nameField.getText());
                    selectedContact.setSurname(surnameField.getText());
                    selectedContact.setPhone(newPhone);
                    selectedContact.setEmail(emailField.getText());
                    selectedContact.setAddress(addressField.getText());
                } else {
                    showError("This phone number already exists.");
                }
            }
        }
        updateContactListModel();
    }

    // Delete selected contacts
    private void deleteContacts() {
        Contact[] selectedContacts = contactJList.getSelectedValuesList().toArray(new Contact[0]);
        for (Contact selectedContact : selectedContacts) {
            contactList.remove(selectedContact);
        }
        updateContactListModel();
    }

    // Update contact list model
    private void updateContactListModel() {
        contactListModel.clear();
        for (Contact contact : contactList) {
            contactListModel.addElement(contact);
        }
    }

    // Search contacts based on the search field
    private void searchContacts(String query) {
        contactListModel.clear();
        for (Contact contact : contactList) {
            if (contact.getFirstName().toLowerCase().contains(query.toLowerCase()) ||
                    contact.getSurname().toLowerCase().contains(query.toLowerCase()) ||
                    contact.getPhone().toLowerCase().contains(query.toLowerCase()) ||
                    contact.getEmail().toLowerCase().contains(query.toLowerCase())) {
                contactListModel.addElement(contact);
            }
        }
    }

    // Sort contacts alphabetically
    private void sortContacts() {
        contactList.sort(Comparator.comparing(Contact::getFirstName));
    }

    // Show contact details in a dialog
    private void showContactDetails(Contact contact) {
        String contactDetails = contact.getFormattedDetails();
        JOptionPane.showMessageDialog(this, contactDetails, "Contact Details", JOptionPane.INFORMATION_MESSAGE);
    }

    // Show error dialog
    private void showError(String message) {
        JOptionPane.showMessageDialog(this, message, "Error", JOptionPane.ERROR_MESSAGE);
    }

    // Perform text action
    private void performText() {
        Contact selectedContact = contactJList.getSelectedValue();
        if (selectedContact != null) {
            JOptionPane.showMessageDialog(this, "Texting " + selectedContact.getPhone() + "...");
        }
    }

    // Perform call action
    private void performCall() {
        Contact selectedContact = contactJList.getSelectedValue();
        if (selectedContact != null) {
            JOptionPane.showMessageDialog(this, "Calling " + selectedContact.getPhone() + "...");
        }
    }

    // Perform video call action
    private void performVideoCall() {
        Contact selectedContact = contactJList.getSelectedValue();
        if (selectedContact != null) {
            JOptionPane.showMessageDialog(this, "Video calling " + selectedContact.getPhone() + "...");
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> {
            ModernPhonebookApp app = new ModernPhonebookApp();
            app.setVisible(true);
        });
    }
}

// Contact class to represent a contact in the phonebook
class Contact {
    private String firstName;
    private String surname;
    private String phone;
    private String email;
    private String address;

    public Contact(String firstName, String surname, String phone, String email, String address) {
        this.firstName = firstName;
        this.surname = surname;
        this.phone = phone;
        this.email = email;
        this.address = address;
    }

    // Getters and setters
    public String getFirstName() { return firstName; }
    public void setFirstName(String firstName) { this.firstName = firstName; }

    public String getSurname() { return surname; }
    public void setSurname(String surname) { this.surname = surname; }

    public String getPhone() { return phone; }
    public void setPhone(String phone) { this.phone = phone; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public String getAddress() { return address; }
    public void setAddress(String address) { this.address = address; }

    // Method to return formatted details
    public String getFormattedDetails() {
        return String.format("Name: %s %s\nPhone: %s\nEmail: %s\nAddress: %s",
                firstName, surname, phone, email, address);
    }

    @Override
    public String toString() {
        return firstName + " " + surname; // Display name in JList
    }
}
